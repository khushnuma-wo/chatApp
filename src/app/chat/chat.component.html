<StackLayout horizontalAlignment="left">
  <ActionBar [title]="'Chat with ' + userName">
    <ActionItem position="left">
      <GridLayout width="40">
        <Image width="35" height="35" android:marginBottom="3"></Image>
      </GridLayout>
    </ActionItem>
    <ActionItem (tap)="goBack()">
      <GridLayout width="70">
        <Image width="20" height="20" android:marginBottom="3" src="~/images/close.png"></Image>
      </GridLayout>
    </ActionItem>
  </ActionBar>
</StackLayout>
<GridLayout class="chat-container" rows="*, auto">
  <GridLayout rows="* auto auto" columns="*" height="100%">
    <ScrollView row="0" height="100%">
      <StackLayout class="message-container" flexDirection="column-reverse">
        <ng-container *ngFor="let message of messages">
          <FlexboxLayout [ngClass]="{'message-row-right': message.isLoggedIn, 'message-row-left': !message.isLoggedIn}"
            padding="10">
            <Image src="~/images/profile2.png" width="35" height="35" class="image"></Image>
            <StackLayout *ngIf="message.isLoggedIn">
              <ng-container *ngIf="message.seen || message.receiverOpened">
                <Image src="~/images/double-tick.png" width="15" height="15" marginTop="5"></Image>
              </ng-container>
              <ng-container *ngIf="!message.seen && !message.receiverOpened">
                <Image src="~/images/single-tick.png" width="10" height="10" marginTop="5"></Image>
              </ng-container>
            </StackLayout>
            <Label [text]="getMessageText(message)"
              [ngClass]="{'right-message-time': message.isLoggedIn, 'left-message-time': !message.isLoggedIn}"></Label>
            <Label [text]="message.message"
              [ngClass]="{'right-message': message.isLoggedIn, 'left-message': !message.isLoggedIn}"></Label>
          </FlexboxLayout>
        </ng-container>
      </StackLayout>
    </ScrollView>
    <StackLayout row="1" backgroundColor="#D7C4E8">
      <ScrollView orientation="horizontal">
        <StackLayout orientation="horizontal">
          <ng-container *ngFor="let imagePath of selectedImagePaths; let i = index">
            <GridLayout rows="auto *">
              <Image [src]="imagePath" width="110" height="110" borderRadius="4" borderWidth="0.5" borderColor="gray"
                stretch="aspectFill" marginRight="20" marginLeft="5" android:marginTop="5" class="selected-image"></Image>
              <Label height="20" width="20" left="100" fontSize="10" backgroundColor="white" borderRadius="40"
                horizontalAlignment="right" text="✖️" row="0" col="1" class="close-button"
                (tap)="removeImage(i)" class="label-delete"></Label>
            </GridLayout>
          </ng-container>
        </StackLayout>
      </ScrollView>
    </StackLayout>
    <!-- <StackLayout row="2" height="1" backgroundColor="#C8C8C8"></StackLayout> -->
    <!-- <Image *ngIf="selectedImagePath" [src]="selectedImagePath" width="100" height="100"></Image> -->
    <GridLayout row="2" columns="auto * auto" padding="10 15">
      <Image src="~/images/add.png" width="22" height="22" marginRight="10" (tap)="onUploadMedia()"></Image>
      <StackLayout col="1" orientation="horizontal" verticalAlignment="center" borderWidth="1" borderColor="#f6f6f6"
        borderRadius="15" height="auto" backgroundColor="#F2F4F8" marginRight="10">
        <TextView hint="Message" padding="5" autocorrect="true" fontSize="14" textWrap="true" minHeight="40"
          height="auto" [(ngModel)]="newMessage"></TextView>
      </StackLayout>
      <StackLayout col="2" verticalAlignment="center">
        <Image src="~/images/send.png" width="30" height="29" marginTop="10" (tap)="sendMessage()"></Image>
      </StackLayout>
    </GridLayout>
    <StackLayout height="60%" width="70%" verticalAlignment="center" horizontalAlignment="center"
      *ngIf="totalMessages===0 && !isLoading">
      <Image src="~/images/noChat.png" height="100" width="100" stretch="aspectFill"></Image>
      <!-- <Label fontWeight="700" class="name" fontSize="18" text="No Chat Available"></Label> -->
    </StackLayout>
    <FlexboxLayout *ngIf="isLoading" height="100%" justifyContent="center" alignItems="center" class="light-overlay">
      <ActivityIndicator [busy]="isLoading" color="blue" width="36" height="36" horizontalAlignment="center">
      </ActivityIndicator>
    </FlexboxLayout>
  </GridLayout>
</GridLayout>